<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>19.&nbsp;Jenkins FAQ</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="up" href="multi__spring_cloud_pipelines.html" title="Part&nbsp;I.&nbsp;Spring Cloud Pipelines"><link rel="prev" href="multi_concourse-faq.html" title="18.&nbsp;Concourse FAQ"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.&nbsp;Jenkins FAQ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multi_concourse-faq.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;I.&nbsp;Spring Cloud Pipelines</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jenkins_faq" href="#jenkins_faq"></a>19.&nbsp;Jenkins FAQ</h2></div></div></div><p>This section provides answers to the most frequently asked questions about using Jenkins with Spring Cloud Pipelines.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Pipeline version contains ${PIPELINE_VERSION}</span></dt><dd><p class="simpara">You can check the Jenkins logs and see the following warning:</p><div class="informalexample"><pre class="programlisting">WARNING: Skipped parameter `PIPELINE_VERSION` as it is undefined on `jenkins-pipeline-sample-build`.
	Set `-Dhudson.model.ParametersAction.keepUndefinedParameters`=true to allow undefined parameters
	to be injected as environment variables or
	`-Dhudson.model.ParametersAction.safeParameters=[comma-separated list]`
	to whitelist specific parameter names, even though it represents a security breach</pre></div><p class="simpara">To fix it, you have to do exactly what the warning suggests. Also, you should ensure that the <code class="literal">Groovy token macro processing</code>
checkbox is set.</p></dd><dt><span class="term">Pipeline version is not passed to the build</span></dt><dd><p class="simpara">You can see that the Jenkins version is properly set. However, in the build version, it is still snapshot and
the <code class="literal">echo "${PIPELINE_VERSION}"</code> does not print anything.</p><p class="simpara">You can check the Jenkins logs and see the following warning:</p><div class="informalexample"><pre class="programlisting">WARNING: Skipped parameter `PIPELINE_VERSION` as it is undefined on `jenkins-pipeline-sample-build`.
	Set `-Dhudson.model.ParametersAction.keepUndefinedParameters`=true to allow undefined parameters
	to be injected as environment variables or
	`-Dhudson.model.ParametersAction.safeParameters=[comma-separated list]`
	to whitelist specific parameter names, even though it represents a security breach</pre></div><p class="simpara">To fix it, you have to do exactly what the warning suggests.</p></dd><dt><span class="term">The build times out with <code class="literal">pipeline.sh</code> information</span></dt><dd><p class="simpara">This is a Docker compose issue. The problem is that for some reason, only in Docker, the execution of
Java hangs. However, it hangs randomly and only the first time you try to run the pipeline.</p><p class="simpara">The solution to this issue is to run the pipeline again. If it passes once,
it will pass for any subsequent build.</p><p class="simpara">Another thing that you can try is to run it with plain Docker. That helps sometimes.</p></dd><dt><span class="term">Can I use the pipeline for some other repositories?</span></dt><dd><p class="simpara">Yes. You can pass the <code class="literal">REPOS</code> variable with a comma-separated list of
<code class="literal">project_name$project_url</code> format. If you do not provide the <code class="literal">PROJECT_NAME</code>, the
repository name is extracted and used as the name of the project.</p><p class="simpara">For example, a <code class="literal">REPOS</code> value equal to <code class="literal"><a class="link" href="https://github.com/spring-cloud-samples/github-analytics,https://github.com/spring-cloud-samples/github-webhook" target="_top">https://github.com/spring-cloud-samples/github-analytics,https://github.com/spring-cloud-samples/github-webhook</a></code>
results in the creation of pipelines with root names <code class="literal">github-analytics</code> and <code class="literal">github-webhook</code>.</p><p class="simpara">For example, a <code class="literal">REPOS</code> equal to <code class="literal">myanalytics$https://github.com/spring-cloud-samples/github-analytics,myfeed$https://github.com/spring-cloud-samples/atom-feed</code>
results in the creation of pipelines with root names <code class="literal">myanalytics</code> for <code class="literal">github-analytics</code>
and <code class="literal">myfeed</code> for <code class="literal">github-webhook</code>.</p></dd><dt><span class="term">Can this work for ANY project out of the box?</span></dt><dd><p class="simpara">Not really. This is an &#8220;opinionated pipeline&#8221;. That is why we took some
opinionated decisions, such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Using Spring Cloud, Spring Cloud Contract Stub Runner, and Spring Cloud Eureka.</li><li class="listitem">Application deployment to Cloud Foundry.</li><li class="listitem"><p class="simpara">Maven, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Using the Maven Wrapper.</li><li class="listitem">Artifacts deployment by using <code class="literal">./mvnw clean deploy</code>.</li><li class="listitem">The <code class="literal">stubrunner.ids</code> property to retrieve the list of collaborators for which stubs should be downloaded.</li><li class="listitem">Running smoke tests on a deployed app with the <code class="literal">smoke</code> Maven profile.</li><li class="listitem">Running end to end tests on a deployed app with the <code class="literal">e2e</code> Maven profile.</li></ul></div></li><li class="listitem"><p class="simpara">Gradle (in the <code class="literal">github-analytics</code> application check in the <code class="literal">gradle/pipeline.gradle</code> file), including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Using the Gradlew Wrapper.</li><li class="listitem">A <code class="literal">deploy</code> task for artifacts deployment.</li><li class="listitem">Running smoke tests on a deployed application with the <code class="literal">smoke</code> task.</li><li class="listitem">Running end to end tests on a deployed application with the <code class="literal">e2e</code> task.</li><li class="listitem">A <code class="literal">groupId</code> task to retrieve group ID.</li><li class="listitem">An <code class="literal">artifactId</code> task to retrieve artifact ID.</li><li class="listitem">A <code class="literal">currentVersion</code> task to retrieve the current version.</li><li class="listitem"><p class="simpara">A <code class="literal">stubIds</code> task to retrieve the list of collaborators for which stubs should be downloaded.</p><p class="simpara">This is the initial approach that can be easily changed in the future.</p></li></ul></div></li></ul></div></dd><dt><span class="term">Can I modify this to reuse in my project?</span></dt><dd>Yes. It is open-source. The important thing is that the core part of the logic is written
in Bash scripts. That way, in the majority of cases, you could change only the bash
scripts without changing the whole pipeline.</dd><dt><span class="term">The rollback step fails due to a missing JAR</span></dt><dd><p class="simpara"><a name="jenkins_tags" href="#jenkins_tags"></a> You must have pushed some tags and have removed the Artifactory volume that
contained them. To fix this, remove the tags by using the following command:</p><div class="informalexample"><pre class="programlisting">git tag -l | xargs -n <span class="hl-number">1</span> git push --delete origin</pre></div></dd><dt><span class="term">I want to provide a different JDK version.</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">By default, we assume that you have configured a JDK with an ID of <code class="literal">jdk8</code>.</li><li class="listitem"><p class="simpara">If you want a different one, override the <code class="literal">JDK_VERSION</code> environment variable to point to the proper one.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The docker image comes in with Java installed at <code class="literal">/usr/lib/jvm/java-8-openjdk-amd64</code>.
You can go to <code class="literal">Global Tools</code> and create a JDK with an ID of <code class="literal">jdk8</code> and set <code class="literal">JAVA_HOME</code>
to <code class="literal">/usr/lib/jvm/java-8-openjdk-amd64</code>.</p></td></tr></table></div></li></ul></div></dd></dl></div><p>To change the default settings, follow the steps shown in the following images:</p><div class="figure"><a name="d0e9120" href="#d0e9120"></a><p class="title"><b>Figure&nbsp;19.1.&nbsp;Click 'Manage Jenkins'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/manage_jenkins.png" alt="manage jenkins"></div></div></div><br class="figure-break"><div class="figure"><a name="d0e9129" href="#d0e9129"></a><p class="title"><b>Figure&nbsp;19.2.&nbsp;Click 'Global Tool'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/global_tool.png" alt="global tool"></div></div></div><br class="figure-break"><div class="figure"><a name="d0e9138" href="#d0e9138"></a><p class="title"><b>Figure&nbsp;19.3.&nbsp;Click 'JDK Installations'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/jdk_installation.png" alt="jdk installation"></div></div></div><br class="figure-break"><div class="figure"><a name="d0e9147" href="#d0e9147"></a><p class="title"><b>Figure&nbsp;19.4.&nbsp;Fill out JDK Installation with path to your JDK</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/jdk.png" alt="jdk"></div></div></div><br class="figure-break"><div class="variablelist"><a name="groovy-token-macro" href="#groovy-token-macro"></a><dl class="variablelist"><dt><span class="term">How can I enable groovy token macro processing?</span></dt><dd>We scripted that. However, if you need to this manually, follow the steps shown in the following images:</dd></dl></div><div class="figure"><a name="d0e9163" href="#d0e9163"></a><p class="title"><b>Figure&nbsp;19.5.&nbsp;Click 'Manage Jenkins'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/manage_jenkins.png" alt="manage jenkins"></div></div></div><br class="figure-break"><div class="figure"><a name="d0e9172" href="#d0e9172"></a><p class="title"><b>Figure&nbsp;19.6.&nbsp;Click 'Configure System'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/configure_system.png" alt="configure system"></div></div></div><br class="figure-break"><div class="figure"><a name="d0e9181" href="#d0e9181"></a><p class="title"><b>Figure&nbsp;19.7.&nbsp;Click 'Allow token macro processing'</b></p><div class="figure-contents"><div class="mediaobject"><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-pipelines/master/docs-sources/src/main/asciidoc/images/jenkins/groovy_token.png" alt="groovy token"></div></div></div><br class="figure-break"><div class="variablelist"><dl class="variablelist"><dt><span class="term">How can I make deployment to stage and prod be automatic?</span></dt><dd><p class="simpara">Set the relevant property or environment variable to <code class="literal">true</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">AUTO_DEPLOY_TO_STAGE</code> to automatically deploy to stage.</li><li class="listitem"><code class="literal">AUTO_DEPLOY_TO_PROD</code> to automatically deploy to prod.</li></ul></div></dd><dt><span class="term">How can I skip testing API compatibility?</span></dt><dd>Set the <code class="literal">API_COMPATIBILITY_STEP_REQUIRED</code> environment variable
to <code class="literal">false</code> and re-run the seed (you can pick it from the seed
job&#8217;s properties, too).</dd><dt><span class="term">I can&#8217;t tag the repo.</span></dt><dd><p class="simpara">You may get an error similar to the following:</p><div class="informalexample"><pre class="programlisting"><span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> stderr: remote: Invalid username or password.
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> fatal: Authentication failed <span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">for</span> <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'https://github.com/marcingrzejszczak/github-webhook/'</span>
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span>
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:<span class="hl-number">1740</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:<span class="hl-number">1476</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl.access$<span class="hl-number">300</span>(CliGitAPIImpl.java:<span class="hl-number">63</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at org.jenkinsci.plugins.gitclient.CliGitAPIImpl$<span class="hl-number">8.</span>execute(CliGitAPIImpl.java:<span class="hl-number">1816</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.plugins.git.GitPublisher.perform(GitPublisher.java:<span class="hl-number">295</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.tasks.BuildStepMonitor$<span class="hl-number">3.</span>perform(BuildStepMonitor.java:<span class="hl-number">45</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.perform(AbstractBuild.java:<span class="hl-number">779</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.performAllBuildSteps(AbstractBuild.java:<span class="hl-number">720</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Build$BuildExecution.post2(Build.java:<span class="hl-number">185</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.AbstractBuild$AbstractBuildExecution.post(AbstractBuild.java:<span class="hl-number">665</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Run.execute(Run.java:<span class="hl-number">1745</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.FreeStyleBuild.run(FreeStyleBuild.java:<span class="hl-number">43</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.ResourceController.execute(ResourceController.java:<span class="hl-number">98</span>)
<span class="hl-number">19</span>:<span class="hl-number">01</span>:<span class="hl-number">44</span> 	at hudson.model.Executor.run(Executor.java:<span class="hl-number">404</span>)</pre></div><p class="simpara">Most likely, you passed a wrong password. Check the <a class="link" href="">credentials</a> section
for how to update your credentials.</p></dd><dt><span class="term">I am unauthorized to deploy infrastructure jars.</span></dt><dd>Most likely, you forgot to update your local <code class="literal">settings.xml</code> file with the Artifactory&#8217;s
setup. Check out <a class="link" href="">this section of the docs and update your <code class="literal">settings.xml</code> file</a>.</dd><dt><span class="term">Signing Artifacts</span></dt><dd>In some cases, it may be required that, when you perform a release, that the artifacts be signed
before you push them to the repository.
To do this, you  need to import your GPG keys into the Docker image that runs Jenkins.
This can be done by placing a file called <code class="literal">public.key</code> that contains your public key
and a file called <code class="literal">private.key</code> that contains your private key in the <code class="literal">seed</code> directory.
These keys are imported by the <code class="literal">init.groovy</code> script runs when Jenkins starts.</dd><dt><span class="term">Using SSH keys for Git</span></dt><dd><p class="simpara">The seed job checks whether an environment variable called <code class="literal">GIT_USE_SSH_KEY</code> is set to <code class="literal">true</code>. If it is <code class="literal">true</code>, the
environment variable called <code class="literal">GIT_SSH_CREDENTIAL_ID</code> is chosen as the one that contains the
ID of the credential that contains SSH private key. By default, <code class="literal">GIT_CREDENTIAL_ID</code> is picked
as the one that contains the username and password to connect to git.</p><p class="simpara">You can set these values in the seed job by filling out the form and toggling a checkbox.</p></dd><dt><span class="term">Deploy to stage fails and does not redeploy a service (Kubernetes).</span></dt><dd>There can be a number of reasons for this issue. Remember, though, that, for stage, we
assume that a sequence of manual steps needs to be performed. We do not
redeploy any existing services, because, most likely, you deliberately
have it set up that way. If, in the logs of your application,
you can see that you cannot connect to a service, first ensure that
the service is forwarding traffic to a pod. Next, if that is not the case,
delete the service and re-run the step in the pipeline. That way,
Spring Cloud Pipelines redeploy the service and the underlying pods.</dd><dt><span class="term">I ran out of resources. (Cloud Foundry)</span></dt><dd><p class="simpara">[jenkins-cf-resources]] When deploying the application to stage or prod, you can get an <code class="literal">Insufficient resources</code> exception. The way to
solve it is to kill some applications from the test and stage environments. To do so, run the following commands:</p><div class="informalexample"><pre class="programlisting">cf target -o pcfdev-org -s pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
cf stop github-webhook
cf stop github-eureka
cf stop stubrunner</pre></div><p class="simpara">You can also run <code class="literal">./tools/cf-helper.sh kill-all-apps</code> to remove all demo-related apps
deployed to PCF Dev.</p></dd><dt><span class="term">Deploying to test or stage or prod fails with an error about finding space (Cloud Foundry)</span></dt><dd><p class="simpara">You receive an exception similar to the following:</p><div class="informalexample"><pre class="programlisting"><span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> API endpoint:   https://api.local.pcfdev.io (API version: <span class="hl-number">2.58</span>.<span class="hl-number">0</span>)
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> User:           user
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Org:            pcfdev-org
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Space:          No space targeted, use <span xmlns:d="http://docbook.org/ns/docbook" class="hl-string">'cf target -s SPACE'</span>
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> FAILED
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Error finding space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
<span class="hl-number">20</span>:<span class="hl-number">26</span>:<span class="hl-number">18</span> Space pcfdev-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span> not found</pre></div><p class="simpara">It means that you forgot to <a class="link" href="">create the spaces</a> in your PCF Dev installation.</p></dd><dt><span class="term">The route is already in use (Cloud Foundry).</span></dt><dd><p class="simpara">If you play around with Jenkins and Concourse, you can end up with routes that are
already occupied, as identified by errors similar to the following:</p><div class="informalexample"><pre class="programlisting">Using route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io
Binding github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io to github-webhook...
FAILED
The route github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>.local.pcfdev.io is already in use.</pre></div><p class="simpara">To resolve the issue, delete the offending routes, by using commands similar to the following:</p><div class="informalexample"><pre class="programlisting">yes | cf delete-route local.pcfdev.io -n github-webhook-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-eureka-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n stubrunner-<span xmlns:d="http://docbook.org/ns/docbook" class="hl-keyword">test</span>
yes | cf delete-route local.pcfdev.io -n github-webhook-stage
yes | cf delete-route local.pcfdev.io -n github-eureka-stage
yes | cf delete-route local.pcfdev.io -n github-webhook-prod
yes | cf delete-route local.pcfdev.io -n github-eureka-prod</pre></div><p class="simpara">You can also run the <code class="literal">./tools/cf-helper.sh delete-routes</code> script.</p></dd><dt><span class="term">How can I run helper scripts against a real Cloud Foundry instance that I&#8217;m logged into?</span></dt><dd><p class="simpara">Assuming that you are already logged into the cluster, uyou can run the
helper script with the <code class="literal">REUSE_CF_LOGIN=true</code> env variable, as shown in the following example:</p><div class="informalexample"><pre class="programlisting">REUSE_CF_LOGIN=true ./tools/cf-helper.sh setup-prod-infra</pre></div><p class="simpara">This script create the MySQL database and the RabbitMQ service and downloads and deploys Eureka
to the space and organization you are logged into.</p></dd></dl></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multi_concourse-faq.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="multi__spring_cloud_pipelines.html">Up</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">18.&nbsp;Concourse FAQ&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="multi_spring-cloud-pipelines.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>