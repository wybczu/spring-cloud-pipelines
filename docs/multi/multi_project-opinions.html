<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>4.&nbsp;Project Opinions</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="multi_spring-cloud-pipelines.html" title="Spring Cloud Pipelines"><link rel="up" href="multi__spring_cloud_pipelines.html" title="Part&nbsp;I.&nbsp;Spring Cloud Pipelines"><link rel="prev" href="multi__opinionated_implementation.html" title="3.&nbsp;Opinionated Implementation"><link rel="next" href="multi__customizing_the_project.html" title="5.&nbsp;Customizing the Project"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.&nbsp;Project Opinions</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multi__opinionated_implementation.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;I.&nbsp;Spring Cloud Pipelines</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="multi__customizing_the_project.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="project-opinions" href="#project-opinions"></a>4.&nbsp;Project Opinions</h2></div></div></div><p>This section goes through the assumptions we made in the project
structure and project properties.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_cloud_foundry_project_opinions" href="#_cloud_foundry_project_opinions"></a>4.1&nbsp;Cloud Foundry Project Opinions</h2></div></div></div><p>We take the following opinionated decisions for a Cloud Foundry based project:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The application is built by using the Maven or Gradle wrapper.</li><li class="listitem">The application is deployed to Cloud Foundry.</li><li class="listitem">Your application needs a <code class="literal">manifest.yml</code> Cloud Foundry descriptor.</li><li class="listitem"><p class="simpara">For the Maven (<a class="link" href="https://github.com/spring-cloud-samples/github-webhook" target="_top">example project</a>), we assume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of the Maven Wrapper.</li><li class="listitem"><p class="simpara"><code class="literal">settings.xml</code> is parametrized to pass the credentials to push code to Artifactory:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><code class="literal">M2_SETTINGS_REPO_ID</code> contains the server ID for Artifactory or Nexus deployment.</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_USERNAME</code> contains the username for Artifactory or Nexus deployment.</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_PASSWORD</code> contains the password for Artifactory or Nexus deployment.</li></ul></div></li><li class="listitem">Artifacts are deployed by <code class="literal">./mvnw clean deploy</code>.</li><li class="listitem">We use the <code class="literal">stubrunner.ids</code> property to retrieve list of collaborators for which stubs should be downloaded.</li><li class="listitem"><code class="literal">repo.with.binaries</code> property (injected by the pipeline): Contains the URL to the repo containing binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">distribution.management.release.id</code> property (injected by the pipeline): Contains the ID of the distribution management. It corresponds to server ID in <code class="literal">settings.xml</code>.</li><li class="listitem"><code class="literal">distribution.management.release.url</code> property (injected by the pipeline): Contains the URL of the repository that contains binaries (for example, Artifactory).</li><li class="listitem">Running API compatibility tests with the <code class="literal">apicompatibility</code> Maven profile.</li><li class="listitem"><code class="literal">latest.production.version</code> property (injected by the pipeline): Contains the latest production version for the repo (retrieved from Git tags).</li><li class="listitem">Running smoke tests on a deployed app with the <code class="literal">smoke</code> Maven profile.</li><li class="listitem">Running end to end tests on a deployed app with the <code class="literal">e2e</code> Maven profile.</li></ul></div></li><li class="listitem"><p class="simpara">For Gradle (<a class="link" href="https://github.com/spring-cloud-samples/github-analytics" target="_top">example project</a> check the <code class="literal">gradle/pipeline.gradle</code> file), we assume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of the Gradlew Wrapper.</li><li class="listitem">A <code class="literal">deploy</code> task for artifact deployment.</li><li class="listitem">The <code class="literal">REPO_WITH_BINARIES_FOR_UPLOAD</code> environment variable (Injected by the pipeline) contains the URL to the repository that contains binaries (for example, Artifactory).</li><li class="listitem">The <code class="literal">M2_SETTINGS_REPO_USERNAME</code> environment variable contains the user name used to send the binary to the repository that contains binaries (for exampl,e Artifactory).</li><li class="listitem">The <code class="literal">M2_SETTINGS_REPO_PASSWORD</code> environment variable contains the password used to send the binary to the repository that contains binaries (for example, Artifactory).</li><li class="listitem">Running API compatibility tests with the <code class="literal">apiCompatibility</code> task.</li><li class="listitem"><code class="literal">latestProductionVersion</code> property (injected by the pipeline): Contains the latest production version for the repository (retrieved from Git tags).</li><li class="listitem">Running smoke tests on a deployed app with the <code class="literal">smoke</code> task.</li><li class="listitem">Running end to end tests on a deployed app with the <code class="literal">e2e</code> task.</li><li class="listitem"><code class="literal">groupId</code> task to retrieve the group ID.</li><li class="listitem"><code class="literal">artifactId</code> task to retrieve the artifact ID.</li><li class="listitem"><code class="literal">currentVersion</code> task to retrieve the current version.</li><li class="listitem"><code class="literal">stubIds</code> task to retrieve the list of collaborators for which stubs should be downloaded.</li></ul></div></li><li class="listitem"><p class="simpara">For PHP (<a class="link" href="https://github.com/spring-cloud-samples/cf-php-example" target="_top">example project</a>), we asssume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of <a class="link" href="https://getcomposer.org/" target="_top">Composer</a>.</li><li class="listitem"><code class="literal">composer install</code> is called to fetch libraries.</li><li class="listitem"><p class="simpara">The whole application is compressed to <code class="literal">tar.gz</code> and uploaded to binary storage.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><code class="literal">REPO_WITH_BINARIES_FOR_UPLOAD</code> environment variable (injected by the pipeline): Contains the URL of the repository that contains binaries (for example, Artifactory)</li><li class="listitem">The <code class="literal">M2_SETTINGS_REPO_USERNAME</code> environment variable contains the user name used to send the binary to the repo containing binaries (for example, Artifactory).</li><li class="listitem">The <code class="literal">M2_SETTINGS_REPO_PASSWORD</code> environment variable contains the password used to send the binary to the repo containing binaries (for example, Artifactory).</li></ul></div></li><li class="listitem"><code class="literal">group-id</code>: Composer task that echoes the group ID.</li><li class="listitem"><code class="literal">app-name</code>: Composer task that echoes application name.</li><li class="listitem"><code class="literal">stub-ids</code>: Composer task that echoes stub runner ids.</li><li class="listitem"><code class="literal">test-apicompatibility</code>: Composer task that is executed for api compatibility tests.</li><li class="listitem"><code class="literal">test-smoke</code>: Composer task that is executed for smoke testing (the <code class="literal">APPLICATION_URL</code> and <code class="literal">STUBRUNNER_URL</code> environment variables are available here to be used).</li><li class="listitem"><code class="literal">test-e2e</code>: Composer task that is executed for end-to-end testing (<code class="literal">APPLICATION_URL</code> env vars is available here to be used)</li><li class="listitem"><code class="literal">target</code> is assumed to be the output folder. Put it in <code class="literal">.gitignore</code></li></ul></div></li><li class="listitem"><p class="simpara">For NodeJS (<a class="link" href="https://github.com/spring-cloud-samples/spring-cloud-contract-nodejs/tree/sc-pipelines" target="_top">example project</a>), we assume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of <a class="link" href="https://www.npmjs.com/" target="_top">npm</a></li><li class="listitem"><code class="literal">npm install</code> is called to fetch libraries.</li><li class="listitem"><code class="literal">npm test</code> is called to run tests.</li><li class="listitem"><code class="literal">npm run group-id</code>: npm task that echoes the group ID.</li><li class="listitem"><code class="literal">npm run app-name</code>: npm task that echoes application name.</li><li class="listitem"><code class="literal">npm run stub-ids</code>: npm task that echoes stub runner IDs.</li><li class="listitem"><code class="literal">npm run test-apicompatibility</code>: npm task that is executed for api compatibility tests.</li><li class="listitem"><code class="literal">npm run test-smoke</code>: npm task that is executed for smoke testing.</li><li class="listitem"><code class="literal">npm run test-e2e</code>: npm task that is executed for end-to-end testing.</li><li class="listitem"><code class="literal">target</code> is assumed to be the output folder. Put it in <code class="literal">.gitignore</code></li></ul></div></li><li class="listitem"><p class="simpara">For .Net (<a class="link" href="https://github.com/spring-cloud-samples/AspNetCoreExample" target="_top">example project</a>):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of <a class="link" href="https://www.microsoft.com/net/core" target="_top">ASP.NET core</a></li><li class="listitem"><code class="literal">dotnet build</code> is called to build the project.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPUnitTests</code> is called to run unit tests.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPIntegrationTests</code> is called to run integration tests.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPPublish /p:Configuration=Release</code> is called to publish a
ZIP with a self-contained DLL, together with all manifests and deployment files.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPGroupId</code> is the npm task that echos the group ID.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPAppName</code> is the npm task that echos application name.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPStubIds</code> is the npm task that echos stub runner IDs.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPApiCompatibilityTest</code> is run for API compatibility tests.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPSmokeTests</code> is executed for smoke testing.</li><li class="listitem"><code class="literal">dotnet msbuild /nologo /t:CFPE2eTests</code> is executed for end-to-end testing.</li><li class="listitem"><code class="literal">target</code> is assumed to be the output folder. Add it to <code class="literal">.gitignore</code>.</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_kubernetes_project_opinions" href="#_kubernetes_project_opinions"></a>4.2&nbsp;Kubernetes Project Opinions</h2></div></div></div><p>We use the following opinionated decisions for a Cloud Foundry based project:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">The application is built by using the Maven or Gradle wrappers.</li><li class="listitem">The application is deployed to Kubernetes.</li><li class="listitem">The Java Docker image needs to allow passing of system properties through the <code class="literal">SYSTEM_PROPS</code> environment variable.</li><li class="listitem"><p class="simpara">For Maven (<a class="link" href="https://github.com/spring-cloud-samples/github-webhook-kubernetes" target="_top">example project</a>), we assume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of the Maven Wrapper.</li><li class="listitem"><p class="simpara"><code class="literal">settings.xml</code> is parametrized to pass the credentials to push code to Artifactory and Docker repositories:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><code class="literal">M2_SETTINGS_REPO_ID</code>: Server ID for Artifactory or Nexus deployment.</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_USERNAME</code>: User name for Artifactory or Nexus deployment.</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_PASSWORD</code>: Password for Artifactory or Nexus deployment.</li><li class="listitem"><code class="literal">DOCKER_SERVER_ID</code>: Server ID for Docker image pushing.</li><li class="listitem"><code class="literal">DOCKER_USERNAME</code>: User name for Docker image pushing.</li><li class="listitem"><code class="literal">DOCKER_PASSWORD</code>: Password for Docker image pushing.</li><li class="listitem"><code class="literal">DOCKER_EMAIL</code>: Email for Artifactory or Nexus deployment</li></ul></div></li><li class="listitem"><code class="literal">DOCKER_REGISTRY_URL</code> environment variable: Contains (Overridable - defaults to DockerHub) URL of the Docker registry.</li><li class="listitem"><code class="literal">DOCKER_REGISTRY_ORGANIZATION</code> environment variable: Contains the organization where your Docker repository resides.</li><li class="listitem">Artifacts and Docker image deployment is done by using <code class="literal">./mvnw clean deploy</code>.</li><li class="listitem"><code class="literal">stubrunner.ids</code> property: To retrieve list of collaborators for which stubs should be downloaded.</li><li class="listitem"><code class="literal">repo.with.binaries</code> property (injected by the pipeline): Contains the URL to the repo containing binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">distribution.management.release.id</code> property (injected by the pipeline): Contains the ID of the distribution management. Corresponds to the server ID in <code class="literal">settings.xml</code></li><li class="listitem"><code class="literal">distribution.management.release.url</code> property (injected by the pipeline): Contains the URL or the repository that contains binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">deployment.yml</code> contains the Kubernetes deployment descriptor.</li><li class="listitem"><code class="literal">service.yml</code> contains the Kubernetes service descriptor.</li><li class="listitem">running API compatibility tests with the <code class="literal">apicompatibility</code> Maven profile.</li><li class="listitem"><code class="literal">latest.production.version</code> property (injected by the pipeline): Contains the latest production version for the repository (retrieved from Git tags).</li><li class="listitem">Running smoke tests on a deployed app with the <code class="literal">smoke</code> Maven profile.</li><li class="listitem">Running end to end tests on a deployed app with the <code class="literal">e2e</code> Maven profile.</li></ul></div></li><li class="listitem"><p class="simpara">For Gradle  (<a class="link" href="https://github.com/spring-cloud-samples/github-analytics-kubernetes" target="_top">example project</a> check the <code class="literal">gradle/pipeline.gradle</code> file), we assume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">Usage of the Gradlew Wrapper.</li><li class="listitem"><code class="literal">deploy</code> task for artifact deployment.</li><li class="listitem"><code class="literal">REPO_WITH_BINARIES_FOR_UPLOAD</code> env var (injected by the pipeline): Contains the URL to the repository that contains binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_USERNAME</code> environment variable: User name used to send the binary to the repository that contains binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">M2_SETTINGS_REPO_PASSWORD</code> environment variable: Password used to send the binary to the repository that contains binaries (for example, Artifactory).</li><li class="listitem"><code class="literal">DOCKER_REGISTRY_URL</code> environment variable: (Overridable - defaults to DockerHub) URL of the Docker registry.</li><li class="listitem"><code class="literal">DOCKER_USERNAME</code> environment variable: User name used to send the the Docker image.</li><li class="listitem"><code class="literal">DOCKER_PASSWORD</code> environment variable: Password used to send the the Docker image.</li><li class="listitem"><code class="literal">DOCKER_EMAIL</code> environment variable: Email used to send the the Docker image.</li><li class="listitem"><code class="literal">DOCKER_REGISTRY_ORGANIZATION</code> environment variable: Contains the organization where your Docker repo resides.</li><li class="listitem"><code class="literal">deployment.yml</code> contains the Kubernetes deployment descriptor.</li><li class="listitem"><code class="literal">service.yml</code> contains the Kubernetes service descriptor.</li><li class="listitem">Running API compatibility tests with the <code class="literal">apiCompatibility</code> task.</li><li class="listitem"><code class="literal">latestProductionVersion</code> property (injected by the pipeline): Contains the latest production version for the repositoryi (retrieved from Git tags).</li><li class="listitem">Running smoke tests on a deployed application with the <code class="literal">smoke</code> task.</li><li class="listitem">Running end to end tests on a deployed application with the <code class="literal">e2e</code> task.</li><li class="listitem"><code class="literal">groupId</code> task to retrieve group ID.</li><li class="listitem"><code class="literal">artifactId</code> task to retrieve artifact ID.</li><li class="listitem"><code class="literal">currentVersion</code> task to retrieve the current version.</li><li class="listitem"><code class="literal">stubIds</code> task to retrieve the list of collaborators for which stubs should be downloaded.</li></ul></div></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multi__opinionated_implementation.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="multi__spring_cloud_pipelines.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="multi__customizing_the_project.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.&nbsp;Opinionated Implementation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="multi_spring-cloud-pipelines.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.&nbsp;Customizing the Project</td></tr></table></div></body></html>